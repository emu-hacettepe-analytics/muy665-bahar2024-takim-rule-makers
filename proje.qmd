---
title: "İSTANBUL'DA SÜRDÜRÜLEBİLİRLİK HARİTASI: NÜFUS, EVSEL ATIK VE KAYNAK TÜKETİMİ ANALİZİ"
number-sections: true
code-fold: true
---

# Projeye Genel Bakış ve Kapsam

**Kaynaklar ve atıklar**, birarada yaşayan insanlar için tüketimi ve yönetimi önemli iki unsurdur. İstanbul genelinde ilçe bazlı olarak İstanbul Büyükşehir Belediyesi 2008 ve sonrası için su tüketimi, doğalgaz tüketimi ve ortaya çıkan evsel atık miktarını veri olarak paylaşmaktadır. Ayrıca ilçe bazlı olarak diğer bazı istatistikler de tutulmuştur. Bu projede amaç, kişi başına düşen su ve doğalgaz tüketimi ile ortaya çıkan evsel atık miktarının *diğer* bazı ilçe bazlı istatistiklerle ilişkilerini gözlemlemek ve ilişkiler üzerine tartışmaktır.

![](assets/images/proje_gorsel_2.jpg){fig-align="center" width="539"}

# Veri Açma ve Ön İşleme

Veri setlerindeki veriler excel dosyalarından çekilerek düzenlenmiş ve ilgilenilen parametrelerin sütunlarda, ilçelerin satırlarda yer aldığı tek bir veri çerçevesinde toplanmıştır.

```{r output=FALSE}
library(readxl)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
library(scales)
library(plotly)
library(ggrepel)
library(ggthemes)
library(kableExtra)

#nüfus verisini açma
nüfus_path <- "nufuslar.xlsx"
nüfus_data <- read_excel(nüfus_path)


nüfus_data <- nüfus_data |> pivot_longer('2008':'2023', names_to = 'yıl', values_to = 'nüfus')


# İlçeye göre ortalama nüfusları tablo şeklinde gösterilim
nüfus_data$yıl  <- as.numeric(nüfus_data$yıl)
nüfus_data$nüfus  <- as.numeric(nüfus_data$nüfus)


ilçe_nüfus_ortalama <- nüfus_data |> 
  group_by(İlçe) |> 
  summarise(nüfus_ortalaması = mean(nüfus))
                                             

#evsel atık verisini açma

evsel_atık_path <- "evsel_atik.xlsx"
evsel_atık_data <- read_excel(evsel_atık_path)

evsel_atık_data <- evsel_atık_data |> pivot_longer('2008':'2023', names_to = 'yıl', values_to = 'evsel_atık')
evsel_atık_data[evsel_atık_data == 0] <- NA

ilçe_atık_ortalama <- evsel_atık_data |> 
  group_by(İlçe) |> 
  summarise( evsel_atık_ortalaması = mean(evsel_atık, na.rm = TRUE))
                                             


ilçe_nüfus_ortalama %>% arrange(desc(nüfus_ortalaması)) 
ilçe_atık_ortalama %>% arrange(desc(evsel_atık_ortalaması)) 

proje_data <- left_join(ilçe_nüfus_ortalama, ilçe_atık_ortalama, by = "İlçe")


proje_data <- proje_data %>% mutate(kişi_başı_atık_miktarı = evsel_atık_ortalaması/nüfus_ortalaması)



su_tüketim_path <- "su_tuketim.xlsx"
su_tüketim_data <- read_excel(su_tüketim_path)



su_tüketim_data <- su_tüketim_data |> pivot_longer('2015':'2023', names_to = 'yıl', values_to = 'su_tüketim')

ilçe_su_ortalama <- su_tüketim_data |> 
  group_by(İlçe) |> 
  summarise( su_tüketim_ortalaması = mean(su_tüketim, na.rm = TRUE))

proje_data <- left_join(proje_data, ilçe_su_ortalama[, c("İlçe", "su_tüketim_ortalaması")], by = "İlçe")

proje_data <- proje_data %>% mutate(kişi_başı_su_tüketim_miktarı = su_tüketim_ortalaması/nüfus_ortalaması)


dogalgaz_tüketim_path <- "dogalgaz_tuketim.xlsx"
dogalgaz_tüketim_data <- read_excel(dogalgaz_tüketim_path)

dogalgaz_tüketim_data <- dogalgaz_tüketim_data %>% group_by(İlçe,Yıl) %>% summarise(yıllık_tüketim= sum(`Dogalgaz Tüketim Miktarı (m3)`))

dogalgaz_tüketim_data <- dogalgaz_tüketim_data %>%
  filter(Yıl != 2023)

ilçe_dogalgaz_ortalama <- dogalgaz_tüketim_data |> 
  group_by(İlçe) |> 
  summarise( dogalgaz_tüketim_ortalaması = mean(yıllık_tüketim, na.rm = TRUE))

proje_data <- left_join(proje_data, ilçe_dogalgaz_ortalama[, c("İlçe", "dogalgaz_tüketim_ortalaması")], by = "İlçe")

proje_data <- proje_data %>% mutate(kişi_başı_dogalgaz_tüketim_miktarı = dogalgaz_tüketim_ortalaması/nüfus_ortalaması)

okuma_yazma_orani_path <- "okuma_yazma_orani.xlsx"
okuma_yazma_orani_data <- read_excel(okuma_yazma_orani_path)
okuma_yazma_orani_data <- okuma_yazma_orani_data %>% mutate(okuma_yazma_oranı = `Okuma Yazma Bilen`/(`Okuma Yazma Bilmeyen`+`Okuma Yazma Bilen`)*100)
okuma_yazma_orani_data <- okuma_yazma_orani_data %>% mutate(okuma_yazma_oranı_normalize = (okuma_yazma_oranı - min(okuma_yazma_oranı)) / max(okuma_yazma_oranı))

proje_data <- left_join(proje_data, okuma_yazma_orani_data[, c("İlçe", "okuma_yazma_oranı_normalize")], by = "İlçe")

teknolojik_erisim_path <- "teknolojik_erisim.xlsx"
teknolojik_erisim_data <- read_excel(teknolojik_erisim_path)
head(teknolojik_erisim_data)

#tek veriye indirgeme
sütun_ortalamaları <- sapply(teknolojik_erisim_data[,-1],mean)
toplam_ortalama <- sum(sütun_ortalamaları)
katsayı = 1/(sütun_ortalamaları/toplam_ortalama)
katsayı[10] <- katsayı[10]*(-3)
teknolojik_erisim_data$teknolojik_erisim_degeri <- rowSums(teknolojik_erisim_data[,-1]*katsayı)
teknolojik_erisim_data <- teknolojik_erisim_data %>%
  mutate(teknolojik_erisim_degeri_normalize = (teknolojik_erisim_degeri - min(teknolojik_erisim_degeri)) / max(teknolojik_erisim_degeri))


proje_data <- left_join(proje_data, teknolojik_erisim_data[, c("İlçe", "teknolojik_erisim_degeri_normalize")], by = "İlçe")

mulkiyet_durumu_path <- "mulkiyet_durumu.xlsx"
mulkiyet_durumu_data <- read_excel(mulkiyet_durumu_path)
mulkiyet_durumu_data <- mulkiyet_durumu_data %>% mutate(ev_sahiplik_oranı = `Ev Sahibi`/(`Ev Sahibi`+`Ev Sahibi Değil`)*100)

proje_data <- left_join(proje_data, mulkiyet_durumu_data[, c("İlçe", "ev_sahiplik_oranı")], by = "İlçe")

#ilçelere kısaltma ekleyelim
proje_data$ilçe_kısaltma <- toupper(substring(abbreviate(proje_data$İlçe, minlength=3),1,4))
#aynı kısaltmaları düzeltme
proje_data[proje_data$İlçe == "Sultangazi", "ilçe_kısaltma"] <- "SLTG"
proje_data[proje_data$İlçe == "Sultanbeyli", "ilçe_kısaltma"] <- "SLTB"


ikamet_suresi_path <- "ikamet_suresi.xlsx"
ikamet_suresi_data <- read_excel(ikamet_suresi_path)
ikamet_suresi_data <- ikamet_suresi_data %>% rename(ortalama_ikamet_suresi=`Ortalama Yıl`)

proje_data <- left_join(proje_data, ikamet_suresi_data[, c("İlçe", "ortalama_ikamet_suresi")], by = "İlçe")



hanehalki_buyukluk_path <- "hanehalki_buyukluk.xlsx"
hanehalki_buyukluk_data <- read_excel(hanehalki_buyukluk_path)
hanehalki_buyukluk_data <- hanehalki_buyukluk_data %>% rename(hanehalki_buyuklugu=`Ortalama Hanehalkı Büyüklüğü 2022`)
proje_data <- left_join(proje_data, hanehalki_buyukluk_data[, c("İlçe", "hanehalki_buyuklugu")], by = "İlçe")


hane_buyukluk_path <- "hane_buyukluk.xlsx"
hane_buyukluk_data <- read_excel(hane_buyukluk_path)
hane_buyukluk_data <- hane_buyukluk_data %>% rename(hane_buyuklugu=`Ortalama Net (m2)`)

proje_data <- left_join(proje_data, hane_buyukluk_data[, c("İlçe", "hane_buyuklugu")], by = "İlçe")


arac_sahiplik_path <- "arac_sahiplik.xlsx"
arac_sahiplik_data <- read_excel(arac_sahiplik_path)
arac_sahiplik_data <- arac_sahiplik_data %>% mutate(arac_sahiplik_oranı = `Özel otomobil/Araç_Var`/(`Özel otomobil/Araç_Var`+`Özel otomobil/Araç_Yok`)*100)
proje_data <- left_join(proje_data, arac_sahiplik_data[, c("İlçe", "arac_sahiplik_oranı")], by = "İlçe")


```

```{r}
kable(head(proje_data, 10), caption="Data")
```

Su ve doğalgaz tüketimi ile evsel atık miktarını görselleştirdik.

```{r}
# İlçelere göre su ve doğalgaz kullanımı ve evsel atık
ggplot(proje_data, aes(x = İlçe)) +
  geom_point(aes(y = kişi_başı_su_tüketim_miktarı, color = "Su Tüketimi (m^3)"), position = "dodge", size = 1) +
  geom_point(aes(y = kişi_başı_dogalgaz_tüketim_miktarı, color = "Doğalgaz Tüketimi (m^3)"), position = "dodge", size = 1) +geom_point(aes(y = kişi_başı_atık_miktarı*100, color = "Evsel Atık (10 kg)"), position = "dodge", size = 1)+
  labs(title = "İlçelere Göre Kişi Başına Düşen Su ve Doğalgaz Tüketimi ve Evsel Atık Miktarı Karşılaştırması", x = "İlçe", y = "Kişi Başına Miktar", color = "Tüketim Türü") +
  scale_color_manual(values = c("Su Tüketimi (m^3)" = "blue", "Doğalgaz Tüketimi (m^3)" = "lightgreen", "Evsel Atık (10 kg)"="red")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Sonrasında, ilçe bazlı verilerin birbirleri ile doğrusal ilişkilerini görmek adına bir korelasyon matrisi çizdirdik.

```{r}
#korelasyon matrisi çizdirme
cor_data <- proje_data[,c("kişi_başı_atık_miktarı", "kişi_başı_su_tüketim_miktarı", "kişi_başı_dogalgaz_tüketim_miktarı", "okuma_yazma_oranı_normalize","teknolojik_erisim_degeri_normalize","ev_sahiplik_oranı","ortalama_ikamet_suresi","hanehalki_buyuklugu","hane_buyuklugu","arac_sahiplik_oranı")]
corr_matrix <- cor(cor_data, use="complete.obs")

library(corrplot)
c1 <- corrplot(corr_matrix, method = "circle")
```

Korelasyon matrisi üzerinde evsel atık miktarı, su ve doğalgaz tüketimi ile diğer verilerin ilişkilerini yorumlamak için, bu üç parametre ile diğer parametreleri görselleştirdik. İlk olarak okuma yazma oranının ilişkisini gözlemledik. Oranlar %99 civarında kümelendiği için veriyi normalize ederek kullandık.

```{r}
#okuma yazma oranı vs tüketimler kod gelcek
```

Devamında teknolojik ürün sahipliği ile olan tüketim ilişkilerini gözlemledik.

```{r}
scale_factor <- 300
proje_data <- proje_data[order(proje_data$teknolojik_erisim_degeri_normalize, decreasing = TRUE), ]

ggplot(proje_data, aes(reorder(İlçe, teknolojik_erisim_degeri_normalize))) +
  geom_point(aes(y = kişi_başı_su_tüketim_miktarı, color = "Su Tüketimi m^3"), position = "dodge", size = 2) +
  geom_point(aes(y = teknolojik_erisim_degeri_normalize*scale_factor, color = "Teknolojik Ürün Erişimi"), position = "dodge", size = 2) +
  labs(title = "Kişi Başı Su Tüketimi ve Teknolojik Ürün Erişimi Karşılaştırması", x = "İlçe", y = "Miktar", color = "Tüketim Türü") +
  scale_color_manual(values = c("Su Tüketimi m^3" = "skyblue", "Teknolojik Ürün Erişimi" = "pink")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))




ggplot(proje_data, aes(reorder(İlçe, teknolojik_erisim_degeri_normalize))) +
  geom_point(aes(y = kişi_başı_dogalgaz_tüketim_miktarı, color = "Doğalgaz Tüketimi m^3"), position = "dodge", size = 2) +
  geom_point(aes(y = teknolojik_erisim_degeri_normalize*scale_factor, color = "Teknolojik Ürün Erişimi"), position = "dodge", size = 2) +
  labs(title = "Kişi Başı Doğalgaz Tüketimi ve Teknolojik Ürün Erişimi Karşılaştırması", x = "İlçe", y = "Miktar", color = "Tüketim Türü") +
  scale_color_manual(values = c("Doğalgaz Tüketimi m^3" = "skyblue", "Teknolojik Ürün Erişimi" = "pink")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))



scale_factor <- 10
ggplot(proje_data, aes(reorder(İlçe, teknolojik_erisim_degeri_normalize))) +
  geom_point(aes(y = kişi_başı_atık_miktarı, color = "Su Tüketimi"), position = "dodge", size = 2) +
  geom_point(aes(y = teknolojik_erisim_degeri_normalize*scale_factor, color = "Teknolojik Ürün Erişimi"), position = "dodge", size = 2) +
  labs(title = "Kişi Başı Evsel Atık ve Teknolojik Ürün Erişimi Karşılaştırması", x = "İlçe", y = "Miktar", color = "Tüketim Türü") +
  scale_color_manual(values = c("Su Tüketimi" = "skyblue", "Teknolojik Ürün Erişimi" = "pink")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

Sonrasında ev sahiplik oranı ile olan tüketim ilişkilerini gözlemledik.

```{r}
#ev sahiplik vs tüketimler kod gelecek
```

Akabinde hanede ortalama ikamet süresi ile olan tüketim ilişkilerini gözlemledik.

```{r}
#hanede ortalama ikamet süresi vs tüketimler kod gelecek
```

Hanehalkı büyüklüğü ile olan tüketim ilişkilerini gözlemleyerek devam ettik.

```{r}
#Hanehalkı büyüklüğü vs tüketimler kod gelecek
```

Hane büyüklüğünün tüketim ile olan ilişkilerini gözlemledik.

```{r}
#Hane büyüklüğü vs tüketimler kod gelecek
```

Nihayetinde son verimiz olan araç sahiplik durumunun tüketim ilişkilerini gözlemledik.

```{r}
#araç sahiplik durumu vs tüketimler kod gelecek
```

# Sonuçlar ve Ana Çıkarımlar

xxxxxx
